<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">


        <title>AIX & PowerVM automation with Ansible</title>

        <!-- Bootstrap Core CSS -->
        <link href="./theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="./theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="./theme/css/code_blocks/darkly.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="Using Ansible to manage AIX/PowerVM servers">

        <meta name="author" content="Kairo Araujo">

        <meta name="tags" content="aix">
        <meta name="tags" content="ansible">
        <meta name="tags" content="automation">
        <meta name="tags" content="modules">
        <meta name="tags" content="setup">
        <meta name="tags" content="howto">

	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="Kairo Araujo">

	<meta property="og:type" content="article">
            <meta property="article:author" content="./author/kairo-araujo.html">
	<meta property="og:url" content="./aix-powervm-automation-with-ansible.html">
	<meta property="og:title" content="AIX & PowerVM automation with Ansible">
	<meta property="article:published_time" content="2017-10-12 23:30:00+02:00">
            <meta property="og:description" content="Using Ansible to manage AIX/PowerVM servers">

            <meta property="og:image" content="./static/dc.jpg">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="./">Kairo Araujo</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                            <li><a href="./pages/about.html">About</a></li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('static/dc.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>AIX & PowerVM automation with Ansible</h1>
                        <span class="meta">Posted by
                                <a href="./author/kairo-araujo.html">Kairo Araujo</a>
                             on Thu 12 October 2017
                        </span>
                            <span class="meta">Updated on Sat 28 October 2017</span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <p><strong>On this post I will show how to setup Ansible control with special modules and
facts for AIX and give you some useful examples.</strong></p>
<p>Ansible is a simple and powerful open source tool to automate repeated tasks
for the system administrator, making life easier.
The biggest advantage of Ansible, in my opinion is that Ansible is agent less
and only has two requirements, SSH and Python on the target.</p>
<p>I have been playing a lot with Ansible to automate AIX and I also have been
writing some contributions to the project to make Ansible work smooth with AIX.</p>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id2">Overview</a><ul>
<li><a class="reference internal" href="#special-modules-facts-for-aix" id="id3">Special modules/facts for AIX</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ansible-control-setup" id="id4">Ansible Control setup</a><ul>
<li><a class="reference internal" href="#operational-system-installation-and-preparation" id="id5">Operational System installation and preparation</a></li>
<li><a class="reference internal" href="#ansible-2-4-installation" id="id6">Ansible 2.4 Installation</a></li>
<li><a class="reference internal" href="#ansible-aix-modules-support-installation" id="id7">Ansible AIX modules/support installation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id1" id="id8">Ansible Control Setup</a><ul>
<li><a class="reference internal" href="#generating-keys" id="id9">Generating keys</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ansible-targets-aix-vios-setup" id="id10">Ansible targets (AIX/VIOS) setup</a><ul>
<li><a class="reference internal" href="#installing-python-on-aix" id="id11">Installing Python on AIX</a></li>
<li><a class="reference internal" href="#distributing-keys" id="id12">Distributing keys</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ansible-inventory-and-validation" id="id13">Ansible Inventory and validation</a><ul>
<li><a class="reference internal" href="#creating-an-inventory" id="id14">Creating an inventory</a></li>
<li><a class="reference internal" href="#checking-configuration" id="id15">Checking configuration</a></li>
<li><a class="reference internal" href="#playbook-example" id="id16">Playbook example</a></li>
<li><a class="reference internal" href="#running-the-playbook" id="id17">Running the playbook</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion" id="id18">Conclusion</a></li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id2">Overview</a></h2>
<p>For that I’m using a Red Hat Linux 7.4 as Ansible control to manage my AIX 6.1, 7.1 and 7.2 servers/nodes.
My servers/nodes are AIXs and Linuxes boxes.</p>
<div class="section" id="special-modules-facts-for-aix">
<h3><a class="toc-backref" href="#id3">Special modules/facts for AIX</a></h3>
<p>I have been writing some AIX modules and core (facts) to make it smoother  for AIX.
All codes I have submitted Pull Requests to Ansible project, my goal is to have it on next versions of Ansible.
While it is not available on the official Ansible repository — I hope to have something on 2.5 —
I created a repository on my Github to make it include this support to current stable version 2.4 .</p>
<p><a class="reference external" href="https://github.com/kairoaraujo/ansible-AIX-support">https://github.com/kairoaraujo/ansible-AIX-support</a></p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="23%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Type</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>module</td>
<td>aix_lvg</td>
<td>AIX Logical Volume management</td>
</tr>
<tr><td>module</td>
<td>aix_devices</td>
<td>AIX Devices management</td>
</tr>
<tr><td>module</td>
<td>aix_filesystem</td>
<td>AIX Files system management (LVM and NFS)</td>
</tr>
<tr><td>module</td>
<td>mksysb</td>
<td>AIX rootvg backup with mksysb</td>
</tr>
<tr><td>module</td>
<td>installp</td>
<td>AIX package management</td>
</tr>
<tr><td>utils</td>
<td>aix</td>
<td>AIX hardware Ansible facts</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="ansible-control-setup">
<h2><a class="toc-backref" href="#id4">Ansible Control setup</a></h2>
<p>Operational System: Red Hat Linux 7.4
Ansible: 2.4
Python: 2.7
Custom modules and core for AIX</p>
<div class="section" id="operational-system-installation-and-preparation">
<h3><a class="toc-backref" href="#id5">Operational System installation and preparation</a></h3>
<p>The Operation System (OS) installation follows a basic installation for Red hat 7.4 as a server.</p>
<p>Requisites for Ansible Control server installation</p>
<ol class="arabic simple">
<li>Validate if Python is already installed</li>
</ol>
<div class="highlight"><pre><span></span><span class="o">[</span>root@ansible-cs ~<span class="o">]</span><span class="c1"># python --version</span>
Python <span class="m">2</span>.7.5
</pre></div>
<ol class="arabic simple" start="2">
<li>Install PIP and python devel</li>
</ol>
<div class="highlight"><pre><span></span><span class="o">[</span>root@ansible-cs ~<span class="o">]</span><span class="c1"># yum install python-pip python-devel</span>
</pre></div>
<ol class="arabic simple" start="3">
<li>Upgrade pip</li>
</ol>
<div class="highlight"><pre><span></span><span class="o">[</span>root@ansible-cs ~<span class="o">]</span><span class="c1"># pip install --upgrade pip</span>
</pre></div>
</div>
<div class="section" id="ansible-2-4-installation">
<h3><a class="toc-backref" href="#id6">Ansible 2.4 Installation</a></h3>
<p>The installation can be done using PIP</p>
<ol class="arabic simple">
<li>Run PIP to install</li>
</ol>
<div class="highlight"><pre><span></span><span class="o">[</span>root@ansible-cs ~<span class="o">]</span><span class="c1"># pip install ansible</span>
</pre></div>
<ol class="arabic simple" start="2">
<li>Check Ansible Version</li>
</ol>
<div class="highlight"><pre><span></span><span class="o">[</span>root@ansible-cs ~<span class="o">]</span><span class="c1"># ansible --version</span>
ansible <span class="m">2</span>.4.0.0
    config <span class="nv">file</span> <span class="o">=</span> None
    configured module search <span class="nv">path</span> <span class="o">=</span> <span class="o">[</span>u<span class="s1">&#39;/root/.ansible/plugins/modules&#39;</span>, u<span class="s1">&#39;/usr/share/ansible/plugins/modules&#39;</span><span class="o">]</span>
    ansible python module <span class="nv">location</span> <span class="o">=</span> /usr/lib/python2.7/site-packages/ansible
    executable <span class="nv">location</span> <span class="o">=</span> /bin/ansible
    python <span class="nv">version</span> <span class="o">=</span> <span class="m">2</span>.7.5 <span class="o">(</span>default, May  <span class="m">3</span> <span class="m">2017</span>, <span class="m">07</span>:55:04<span class="o">)</span> <span class="o">[</span>GCC <span class="m">4</span>.8.5 <span class="m">20150623</span> <span class="o">(</span>Red Hat <span class="m">4</span>.8.5-14<span class="o">)]</span>
</pre></div>
</div>
<div class="section" id="ansible-aix-modules-support-installation">
<h3><a class="toc-backref" href="#id7">Ansible AIX modules/support installation</a></h3>
<ol class="arabic simple">
<li>Download from github</li>
</ol>
<p><a class="reference external" href="https://github.com/kairoaraujo/ansible-aix-support/releases/download/0.0.3/ansible-aix-support-0.0.3.tar.gz">https://github.com/kairoaraujo/ansible-aix-support/releases/download/0.0.3/ansible-aix-support-0.0.3.tar.gz</a></p>
<p>Extract the file</p>
<div class="highlight"><pre><span></span><span class="o">[</span>root@ansible-cs ~<span class="o">]</span><span class="c1"># tar xvzf ansible-aix-support-0.0.3.tar.gz</span>
</pre></div>
<p>Or download using git</p>
<div class="highlight"><pre><span></span><span class="o">[</span>root@ansible-cs ~<span class="o">]</span><span class="c1"># git clone https://github.com/kairoaraujo/ansible-aix-support</span>
</pre></div>
<ol class="arabic simple" start="2">
<li>Go to the directory</li>
</ol>
<div class="highlight"><pre><span></span><span class="o">[</span>root@ansible-cs ~<span class="o">]</span><span class="c1"># cd ansible-aix-support</span>
</pre></div>
<ol class="arabic simple" start="3">
<li>Run installation script</li>
</ol>
<div class="highlight"><pre><span></span><span class="o">[</span>root@ansible-cs ansible-aix-support<span class="o">]</span><span class="c1"># sh install-ansible-aix-support.sh</span>
Starting installation of Ansible AIX support

<span class="o">[</span>INFO<span class="o">]</span> Checking Ansible installation.
<span class="o">[</span>INFO<span class="o">]</span> Ansible found.
<span class="o">[</span>INFO<span class="o">]</span> Checking Ansible installation
<span class="o">[</span>INFO<span class="o">]</span> Version compatible.
<span class="o">[</span>INFO<span class="o">]</span> Backup file /usr/lib/python2.7/site-packages/ansible/module_utils/facts/hardware/aix.py
<span class="o">[</span>INFO<span class="o">]</span> Adding /usr/lib/python2.7/site-packages/ansible/module_utils/facts/hardware/aix.py
<span class="o">[</span>INFO<span class="o">]</span> Adding /usr/lib/python2.7/site-packages/ansible/modules/packaging/os/installp.py
<span class="o">[</span>INFO<span class="o">]</span> Adding /usr/lib/python2.7/site-packages/ansible/modules/system/aix_filesystem.py
<span class="o">[</span>INFO<span class="o">]</span> Adding /usr/lib/python2.7/site-packages/ansible/modules/system/aix_lvg.py
<span class="o">[</span>INFO<span class="o">]</span> Adding /usr/lib/python2.7/site-packages/ansible/modules/system/mksysb.py
<span class="o">[</span>INFO<span class="o">]</span> Finished.
</pre></div>
<ol class="arabic simple" start="3">
<li>Verifying</li>
</ol>
<div class="highlight"><pre><span></span><span class="o">[</span>root@ansible-cs ~<span class="o">]</span><span class="c1"># ansible-doc aix_lvg</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id8">Ansible Control Setup</a></h2>
<div class="section" id="generating-keys">
<h3><a class="toc-backref" href="#id9">Generating keys</a></h3>
<p>On Ansible Control you need to generate the keys to be used by targets (AIX/VIOSes).</p>
<div class="highlight"><pre><span></span><span class="o">[</span>root@ansible-cs ~<span class="o">]</span><span class="c1"># ssh-keygen</span>
Generating public/private rsa key pair.
Enter file in which to save the key <span class="o">(</span>/root/.ssh/id_rsa<span class="o">)</span>:
Created directory <span class="s1">&#39;/root/.ssh&#39;</span>.
Enter passphrase <span class="o">(</span>empty <span class="k">for</span> no passphrase<span class="o">)</span>:
Enter same passphrase again:
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:FsuneRLg7Ugqk4rp12Goip8GaQAaBEFNIANZCgSU1l8 root@ansible-cs
The key<span class="err">&#39;</span>s randomart image is:
+---<span class="o">[</span>RSA <span class="m">2048</span><span class="o">]</span>----+
<span class="p">|</span>^XB.             <span class="p">|</span>
<span class="p">|</span>*<span class="o">=</span> o   E         <span class="p">|</span>
<span class="p">|</span><span class="o">=</span>.  . o .        <span class="p">|</span>
<span class="p">|</span>o    o + o       <span class="p">|</span>
<span class="p">|</span>..  . o S .      <span class="p">|</span>
<span class="p">|</span>o. <span class="nv">o</span> <span class="o">=</span> + <span class="o">=</span>       <span class="p">|</span>
<span class="p">|</span>..<span class="o">=</span> + <span class="nv">o</span> <span class="o">=</span> .      <span class="p">|</span>
<span class="p">|</span>o+.<span class="o">=</span> .   o       <span class="p">|</span>
<span class="p">|</span>O++              <span class="p">|</span>
+----<span class="o">[</span>SHA256<span class="o">]</span>-----+
</pre></div>
</div>
</div>
<div class="section" id="ansible-targets-aix-vios-setup">
<h2><a class="toc-backref" href="#id10">Ansible targets (AIX/VIOS) setup</a></h2>
<p>Ansible is agentless, this means that Ansible installation is not required.
Ansible requires just two things: SSH (probably you already have it) and Python.</p>
<div class="section" id="installing-python-on-aix">
<h3><a class="toc-backref" href="#id11">Installing Python on AIX</a></h3>
<p>So, to install Python on AIX I recommend downloading AIX Python package from <a class="reference external" href="http://www.aixtools.net/index.php/python">http://www.aixtools.net/index.php/python</a></p>
<p>Remark: The only requisite is &gt;= openssl.base.rte.1.0.1.515</p>
<ol class="arabic simple">
<li>Send the package to AIX boxes on /tmp</li>
<li>Install using installp command</li>
</ol>
<div class="highlight"><pre><span></span><span class="c1"># installp -aF -XY -d /tmp/ aixtools.python</span>
</pre></div>
<ol class="arabic simple" start="4">
<li>Create the symbolic links</li>
</ol>
<div class="highlight"><pre><span></span><span class="c1"># ln -s /opt/bin/python /usr/bin/python</span>
<span class="c1"># ln -s /opt/bin/pip /usr/bin/pip</span>
</pre></div>
<ol class="arabic simple" start="3">
<li>Test it</li>
</ol>
<div class="highlight"><pre><span></span><span class="c1"># python python --version</span>
Python <span class="m">2</span>.7.12
</pre></div>
</div>
<div class="section" id="distributing-keys">
<h3><a class="toc-backref" href="#id12">Distributing keys</a></h3>
<p>The easy way to distribute the SSH keys to the AIX/VIOS servers is using ssh-copy-id</p>
<p>If you cannot use keys with root to use SSH, Ansible supports sudo. This means that you can have another user to connect to AIX/VIOS and run Ansible with sudo. Check out <a class="reference external" href="http://docs.ansible.com/ansible/latest/become.html">http://docs.ansible.com/ansible/latest/become.html</a></p>
<p>In that case, you need to use ssh-copy-id to user that you want to perform Ansible connection and have properly sudoers configured.</p>
<p>On that example we are using root.</p>
<div class="highlight"><pre><span></span><span class="o">[</span>root@ansible-cs ~<span class="o">]</span><span class="c1"># ssh-copy-id -i .ssh/id_rsa.pub root@lpar24</span>
<span class="o">[</span>root@ansible-cs ~<span class="o">]</span><span class="c1"># ssh-copy-id -i .ssh/id_rsa.pub root@lpar28</span>
<span class="o">(</span>...<span class="o">)</span>
</pre></div>
<p>Example from root to user ansible.</p>
<div class="highlight"><pre><span></span><span class="o">[</span>root@ansible-cs ~<span class="o">]</span><span class="c1"># ssh-copy-id -i .ssh/id_rsa ansible@lpar24</span>
<span class="o">[</span>root@ansible-cs ~<span class="o">]</span><span class="c1"># ssh-copy-id -i .ssh/id_rsa ansible@lpar28</span>
<span class="o">(</span>...<span class="o">)</span>
</pre></div>
<p>Another way is to copy the .ssh/id_rsa.pub to the AIX LPAR to root the user home (or another user), inside .ssh/authorized_keys</p>
</div>
</div>
<div class="section" id="ansible-inventory-and-validation">
<h2><a class="toc-backref" href="#id13">Ansible Inventory and validation</a></h2>
<p>To perform Ansible in your environment an Inventory on Ansible Control is required.
The Inventory will have your target definitions, I encourage you to read it <a class="reference external" href="http://docs.ansible.com/ansible/latest/intro_inventory.html">http://docs.ansible.com/ansible/latest/intro_inventory.html</a>
You can also have a dynamic inventory, you can search about it ;)</p>
<div class="section" id="creating-an-inventory">
<h3><a class="toc-backref" href="#id14">Creating an inventory</a></h3>
<p>On this doc I created a simple inventory as example, including also a Linux server.</p>
<div class="highlight"><pre><span></span><span class="o">[</span>root@ansible-cs ~<span class="o">]</span><span class="c1"># cat /etc/ansible_inventory</span>
<span class="c1"># Global variables</span>
<span class="o">[</span>all:vars<span class="o">]</span>
<span class="nv">ansible_user</span><span class="o">=</span>root

<span class="o">[</span>aix<span class="o">]</span>
lpar24
lpar28

<span class="o">[</span>hacmp<span class="o">]</span>
lpar21
lpar22

<span class="o">[</span>legacy<span class="o">]</span>
lpar23

<span class="o">[</span>linux<span class="o">]</span>
linux4
</pre></div>
<p>As you can see, I also included a Linux to show how you can manage both platforms together.</p>
</div>
<div class="section" id="checking-configuration">
<h3><a class="toc-backref" href="#id15">Checking configuration</a></h3>
<p>Let's check if our configuration is working well:</p>
<div class="highlight"><pre><span></span><span class="o">[</span>root@ansible-cs ~<span class="o">]</span><span class="c1"># ansible -i /etc/inventory all -m ping</span>
lpar24 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false,
    <span class="s2">&quot;failed&quot;</span>: false,
    <span class="s2">&quot;ping&quot;</span>: <span class="s2">&quot;pong&quot;</span>
<span class="o">}</span>
lpar28 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false,
    <span class="s2">&quot;failed&quot;</span>: false,
    <span class="s2">&quot;ping&quot;</span>: <span class="s2">&quot;pong&quot;</span>
<span class="o">}</span>
lpar22 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false,
    <span class="s2">&quot;failed&quot;</span>: false,
    <span class="s2">&quot;ping&quot;</span>: <span class="s2">&quot;pong&quot;</span>
<span class="o">}</span>
lpar23 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false,
    <span class="s2">&quot;failed&quot;</span>: false,
    <span class="s2">&quot;ping&quot;</span>: <span class="s2">&quot;pong&quot;</span>
<span class="o">}</span>
lpar21 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false,
    <span class="s2">&quot;failed&quot;</span>: false,
    <span class="s2">&quot;ping&quot;</span>: <span class="s2">&quot;pong&quot;</span>
<span class="o">}</span>
linux4 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false,
    <span class="s2">&quot;failed&quot;</span>: false,
    <span class="s2">&quot;ping&quot;</span>: <span class="s2">&quot;pong&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="section" id="playbook-example">
<h3><a class="toc-backref" href="#id16">Playbook example</a></h3>
<p>Playbooks are configurations, deployments and tasks that you want to perform in a target host.
For more details, check out <a class="reference external" href="http://docs.ansible.com/ansible/latest/playbooks.html">http://docs.ansible.com/ansible/latest/playbooks.html</a></p>
<p>My first example of playbook will be: Create a filesystem for images and install TSM software and generate a mksysb backup.</p>
<p>In details my tasks are:</p>
<ul class="simple">
<li>Logical Volume with 5GB (lvmksysb) Remark: (only for servers that I already have +5GB free on vg)</li>
<li>Create a filesystem using lvmksysb (/mksysb/images)</li>
<li>Install TSM software</li>
</ul>
<p>My playbook:</p>
<div class="highlight"><pre><span></span>[root@ansible-cs ~]# cat /playbooks/pb-mksysb-tsm.yml
---
- name: mksysb &amp; tsm client install
  hosts: prd

  tasks:
    - name: Create LV (mksysblv) with 5GB
      aix_lvol:
        vg: rootvg
        lv: mksysblv
        size: 5G
        state: present
      register: lv_result
      when:
        - ansible_system == &quot;AIX&quot;

    - name: Create file system using mksysblv
      aix_filesystem:
        device: mksysblv
        filesystem: /mksysb/images
        state: present
      register: fs_result
      when:
        - lv_result.changed

    - name: Mount filesystem /mksysb/images
      aix_filesystem:
        filesystem: /mksysb/images
        state: mounted
      register: mount_result
      when:
        - fs_result.changed

    - name: Install TSM client
      installp:
        repository_path: /software/tsm/TSMCLI
        name: all
        state: present
      when:
        - ansible_system == &quot;AIX&quot;

    - name: Generate a mksysb on /mksysb/images
      mksysb:
        name: myserver
        storage_path: /mksysb/images
        exclude_files: yes
        exclude_wpar_files: yes
      when:
        - ansible_system == &quot;AIX&quot;
        - ansible_nodename == &quot;lpar28&quot;
</pre></div>
</div>
<div class="section" id="running-the-playbook">
<h3><a class="toc-backref" href="#id17">Running the playbook</a></h3>
<div class="highlight"><pre><span></span><span class="o">[</span>root@ansible-cs ~<span class="o">]</span><span class="c1"># ansible-playbook -i /etc/inventory /playbooks/pb-mksysb-tsm.yml -v</span>

PLAY <span class="o">[</span>mksysb <span class="p">&amp;</span> tsm client install<span class="o">]</span> **********************************************************************************************

TASK <span class="o">[</span>Gathering Facts<span class="o">]</span> **********************************************************************************************************
ok: <span class="o">[</span>linux4<span class="o">]</span>
ok: <span class="o">[</span>lpar28<span class="o">]</span>
ok: <span class="o">[</span>lpar24<span class="o">]</span>

TASK <span class="o">[</span>Create LV <span class="o">(</span>mksysblv<span class="o">)</span> with 5GB<span class="o">]</span> ********************************************************************************************
skipping: <span class="o">[</span>linux4<span class="o">]</span> <span class="o">=</span>&gt; <span class="o">{</span><span class="s2">&quot;changed&quot;</span>: false, <span class="s2">&quot;skip_reason&quot;</span>: <span class="s2">&quot;Conditional result was False&quot;</span>, <span class="s2">&quot;skipped&quot;</span>: true<span class="o">}</span>
changed: <span class="o">[</span>lpar28<span class="o">]</span> <span class="o">=</span>&gt; <span class="o">{</span><span class="s2">&quot;changed&quot;</span>: true, <span class="s2">&quot;failed&quot;</span>: false, <span class="s2">&quot;msg&quot;</span>: <span class="s2">&quot;Logical volume mksysblv created.&quot;</span><span class="o">}</span>
changed: <span class="o">[</span>lpar24<span class="o">]</span> <span class="o">=</span>&gt; <span class="o">{</span><span class="s2">&quot;changed&quot;</span>: true, <span class="s2">&quot;failed&quot;</span>: false, <span class="s2">&quot;msg&quot;</span>: <span class="s2">&quot;Logical volume mksysblv created.&quot;</span><span class="o">}</span>

TASK <span class="o">[</span>Create file system using mksysblv<span class="o">]</span> ****************************************************************************************
skipping: <span class="o">[</span>linux4<span class="o">]</span> <span class="o">=</span>&gt; <span class="o">{</span><span class="s2">&quot;changed&quot;</span>: false, <span class="s2">&quot;skip_reason&quot;</span>: <span class="s2">&quot;Conditional result was False&quot;</span>, <span class="s2">&quot;skipped&quot;</span>: true<span class="o">}</span>
changed: <span class="o">[</span>lpar28<span class="o">]</span> <span class="o">=</span>&gt; <span class="o">{</span><span class="s2">&quot;changed&quot;</span>: true, <span class="s2">&quot;failed&quot;</span>: false, <span class="s2">&quot;msg&quot;</span>: <span class="s2">&quot;File system created successfully.\n5242516 kilobytes total disk space.\nNew File System size is 10485760\n&quot;</span>, <span class="s2">&quot;state&quot;</span>: <span class="s2">&quot;present&quot;</span><span class="o">}</span>
changed: <span class="o">[</span>lpar24<span class="o">]</span> <span class="o">=</span>&gt; <span class="o">{</span><span class="s2">&quot;changed&quot;</span>: true, <span class="s2">&quot;failed&quot;</span>: false, <span class="s2">&quot;msg&quot;</span>: <span class="s2">&quot;File system created successfully.\n5242516 kilobytes total disk space.\nNew File System size is 10485760\n&quot;</span>, <span class="s2">&quot;state&quot;</span>: <span class="s2">&quot;present&quot;</span><span class="o">}</span>

TASK <span class="o">[</span>Mount filesystem /mksysb/images<span class="o">]</span> ******************************************************************************************
skipping: <span class="o">[</span>linux4<span class="o">]</span> <span class="o">=</span>&gt; <span class="o">{</span><span class="s2">&quot;changed&quot;</span>: false, <span class="s2">&quot;skip_reason&quot;</span>: <span class="s2">&quot;Conditional result was False&quot;</span>, <span class="s2">&quot;skipped&quot;</span>: true<span class="o">}</span>
changed: <span class="o">[</span>lpar28<span class="o">]</span> <span class="o">=</span>&gt; <span class="o">{</span><span class="s2">&quot;changed&quot;</span>: true, <span class="s2">&quot;failed&quot;</span>: false, <span class="s2">&quot;msg&quot;</span>: <span class="s2">&quot;File system /mksysb/images mounted.&quot;</span>, <span class="s2">&quot;state&quot;</span>: <span class="s2">&quot;mounted&quot;</span><span class="o">}</span>
changed: <span class="o">[</span>lpar24<span class="o">]</span> <span class="o">=</span>&gt; <span class="o">{</span><span class="s2">&quot;changed&quot;</span>: true, <span class="s2">&quot;failed&quot;</span>: false, <span class="s2">&quot;msg&quot;</span>: <span class="s2">&quot;File system /mksysb/images mounted.&quot;</span>, <span class="s2">&quot;state&quot;</span>: <span class="s2">&quot;mounted&quot;</span><span class="o">}</span>

TASK <span class="o">[</span>Install TSM client<span class="o">]</span> *******************************************************************************************************
skipping: <span class="o">[</span>linux4<span class="o">]</span> <span class="o">=</span>&gt; <span class="o">{</span><span class="s2">&quot;changed&quot;</span>: false, <span class="s2">&quot;skip_reason&quot;</span>: <span class="s2">&quot;Conditional result was False&quot;</span>, <span class="s2">&quot;skipped&quot;</span>: true<span class="o">}</span>
changed: <span class="o">[</span>lpar24<span class="o">]</span> <span class="o">=</span>&gt; <span class="o">{</span><span class="s2">&quot;changed&quot;</span>: true, <span class="s2">&quot;failed&quot;</span>: false, <span class="s2">&quot;msg&quot;</span>: <span class="s2">&quot; Installed: all.&quot;</span><span class="o">}</span>
changed: <span class="o">[</span>lpar28<span class="o">]</span> <span class="o">=</span>&gt; <span class="o">{</span><span class="s2">&quot;changed&quot;</span>: true, <span class="s2">&quot;failed&quot;</span>: false, <span class="s2">&quot;msg&quot;</span>: <span class="s2">&quot; Installed: all.&quot;</span><span class="o">}</span>

TASK <span class="o">[</span>Generate a mksysb on /mksysb/images<span class="o">]</span> **************************************************************************************
skipping: <span class="o">[</span>lpar24<span class="o">]</span> <span class="o">=</span>&gt; <span class="o">{</span><span class="s2">&quot;changed&quot;</span>: false, <span class="s2">&quot;skip_reason&quot;</span>: <span class="s2">&quot;Conditional result was False&quot;</span>, <span class="s2">&quot;skipped&quot;</span>: true<span class="o">}</span>
skipping: <span class="o">[</span>linux4<span class="o">]</span> <span class="o">=</span>&gt; <span class="o">{</span><span class="s2">&quot;changed&quot;</span>: false, <span class="s2">&quot;skip_reason&quot;</span>: <span class="s2">&quot;Conditional result was False&quot;</span>, <span class="s2">&quot;skipped&quot;</span>: true<span class="o">}</span>
changed: <span class="o">[</span>lpar28<span class="o">]</span> <span class="o">=</span>&gt; <span class="o">{</span><span class="s2">&quot;changed&quot;</span>: true, <span class="s2">&quot;failed&quot;</span>: false, <span class="s2">&quot;msg&quot;</span>: <span class="s2">&quot;\nCreating information file (/image.data) for rootvg.\n\nCreating list of files to back up \n.\nBacking up 80239 files........................\n\n80239 of 80239 files backed up (100%)\n0512-038 mksysb: Backup Completed Successfully.\n&quot;</span><span class="o">}</span>

PLAY RECAP **********************************************************************************************************************
linux4                     : <span class="nv">ok</span><span class="o">=</span><span class="m">1</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">0</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>
lpar24                     : <span class="nv">ok</span><span class="o">=</span><span class="m">5</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">4</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>
lpar28                     : <span class="nv">ok</span><span class="o">=</span><span class="m">6</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">5</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#id18">Conclusion</a></h2>
<p>Ansible is simple tool that can helps a lot system administrators and DevOps to manage their environments.
In my humble opinion the Ansible documentation is nice and there are a lot of training, tutorials, webinars
that can help develop the skills about Ansible.</p>
<p>I will keep working on modules and more support between Ansible and AIX/PowerVM.</p>
<p>Suggestions are welcome. :)</p>
</div>

    </article>

        <div class="tags">
            <p>tags: <a href="./tag/aix.html">aix</a>, <a href="./tag/ansible.html">ansible</a>, <a href="./tag/automation.html">automation</a>, <a href="./tag/modules.html">modules</a>, <a href="./tag/setup.html">setup</a>, <a href="./tag/howto.html">howto</a></p>
        </div>

    <hr>

        <div class="comments">
            <h2>Comments !</h2>
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'kairoaraujo';
                var disqus_identifier = 'aix-powervm-automation-with-ansible.html';
                var disqus_url = './aix-powervm-automation-with-ansible.html';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//kairoaraujo.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://linkedin/in/kairoaraujo">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="http://github.com/kairoaraujo">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://linkedin/in/kairoaraujo">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<p class="copyright text-muted">
    Blog powered by <a href="http://getpelican.com">Pelican</a>,
    which takes great advantage of <a href="http://python.org">Python</a>. <br />        &copy;  Kairo Araujo 
    <br />
    These are my personal opinions
</p>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="./theme/js/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="./theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="./theme/js/clean-blog.min.js"></script>

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-108092336-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'kairoaraujo';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>

</html>